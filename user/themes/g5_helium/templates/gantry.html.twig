{% extends 'partials/base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {% do grav.assets.removeCss(theme_url ~ '/css/fork-awesome.min.css') %}
{% endblock %}

{% block content %}
    {{ content|raw }}
{% endblock %}

{# ProductDiv Integration - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ #}
{% block bottom %}
    {{ parent() }}
    
    {# –û–¢–õ–ê–î–ö–ê: –í—Å–µ–≥–¥–∞ –≤—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ #}
    <script>
        console.log('üîç ProductDiv Debug Info:');
        console.log('User authenticated: {{ grav.user.authenticated ? "YES" : "NO" }}');
        console.log('User username: {{ grav.user.username|default("not logged in") }}');
        console.log('Admin access: {{ grav.user.authorize('admin.login') ? "YES" : "NO" }}');
    </script>
    
    {% if grav.user.authenticated and grav.user.authorize('admin.login') %}
    <script>
        console.log('‚úÖ –£—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã - –∑–∞–≥—Ä—É–∂–∞–µ–º ProductDiv');
    </script>
    
    {# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ProductDiv CDN #}
    <script src="https://cdn.jsdelivr.net/npm/productdiv@latest/dist/productdiv.min.js"></script>
    
    {# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ProductDiv #}
    <script src="{{ url('theme://js/productdiv-config.js') }}"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ProductDiv —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
        (function() {
            console.log('üöÄ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ProductDiv');
            
            // –û–∂–∏–¥–∞–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initProductDiv);
            } else {
                initProductDiv();
            }
            
            function initProductDiv() {
                try {
                    console.log('üì¶ ProductDiv –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.ProductDiv !== 'undefined');
                    console.log('üì¶ ProductDivConfig –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.ProductDivConfig !== 'undefined');
                    
                    // –û–∂–∏–¥–∞–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    if (typeof window.ProductDivConfig !== 'undefined' && typeof window.ProductDiv !== 'undefined') {
                        window.ProductDiv(window.ProductDivConfig.configuration, window.ProductDivConfig.editorOptions);
                        console.log('‚úÖ ProductDiv —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    } else {
                        console.warn('‚ö†Ô∏è ProductDiv –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                        // –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
                        if (typeof window.ProductDiv !== 'undefined') {
                            window.ProductDiv({
                                treeViewIgnoreQuerySelectors: [
                                    'script',
                                    'style',
                                    'link',
                                    '[data-productdiv="true"]',
                                    'svg'
                                ],
                                utilityClasses: [],
                                templates: []
                            });
                            console.log('‚úÖ ProductDiv –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∞–∑–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏');
                        }
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ProductDiv:', error);
                }
            }
        })();
    </script>
    {% else %}
    <script>
        console.log('‚ùå –£—Å–ª–æ–≤–∏—è –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω—ã - ProductDiv –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è');
        console.log('–ü—Ä–∏—á–∏–Ω–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
    </script>
    {% endif %}
{% endblock %}
